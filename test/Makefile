include ../makefile.inc

CXX=g++
FLAGS=
INC=-I../src/common
LIB=

SRC_DIR=../src
COMMON_DIR=../src/common
ESOCKET_DIR=../src/esocket

MEMORY_POOL_TEST=memory_pool_test
MEMORY_POOL_INC=-I$(COMMON_DIR)
MEMORY_POOL_TEST_SRC=$(MEMORY_POOL_TEST).cpp

BYTE_BUFFER_TEST=byte_buffer_test
BYTE_BUFFER_INC=-I$(COMMON_DIR) -I$(SRC_DIR)
BYTE_BUFFER_TEST_SRC=$(BYTE_BUFFER_TEST).cpp $(COMMON_DIR)/byte_buffer.cpp

ESOCKET_TEST=esocket_test
ESOCKET_CLIENT_TEST=esocket_client_test
ESOCKET_SERVER_TEST=esocket_server_test
ESOCKET_INC=-I$(ESOCKET_DIR) -I$(SRC_DIR) -I$(COMMON_DIR)
ESOCKET_SRC=$(COMMON_DIR)/byte_buffer.cpp $(ESOCKET_DIR)/tcp_socket.cpp
ESOCKET_CLIENT_SRC_TEST=$(ESOCKET_SRC) $(ESOCKET_CLIENT_TEST).cpp
ESOCKET_SERVER_SRC_TEST=$(ESOCKET_SRC) $(ESOCKET_SERVER_TEST).cpp


TEST_TARGETS=$(MEMORY_POOL_TEST) $(BYTE_BUFFER_TEST) $(ESOCKET_CLIENT_TEST) $(ESOCKET_SERVER_TEST)
 

.PHONY: all test

all:
	@echo "Nothing to do"

test: $(TEST_TARGETS)

$(MEMORY_POOL_TEST):
	$(CXX) $(FLAGS) $(MEMORY_POOL_INC) $(LIB) $(MEMORY_POOL_TEST_SRC) -D MEMORY_POOL -o $(MEMORY_POOL_TEST)

$(BYTE_BUFFER_TEST):
	$(CXX) $(FLAGS) $(BYTE_BUFFER_INC) $(LIB) $(BYTE_BUFFER_TEST_SRC) -D ECBUFFER -o $(BYTE_BUFFER_TEST)

$(ESOCKET_TEST):
	$(CXX) $(FLAGS) $(ESOCKET_INC) $(LIB) $(ESOCKET_SERVER_SRC_TEST) -D ECBUFFER -o $(ESOCKET_SERVER_TEST)
	$(CXX) $(FLAGS) $(ESOCKET_INC) $(LIB) $(ESOCKET_CLIENT_SRC_TEST) -D ECBUFFER -o $(ESOCKET_CLIENT_TEST)

clean:
	rm -rf $(TEST_TARGETS)
